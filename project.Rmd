---
title: "Project: Wine Quality"
author: 
- "Jovan Burgos"
- "Adrienne Eddy"
- "Chad Michael Eyer"
- "Valorie Myer"
- "Tyler Watson"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    includes:
      after_body: doc_prefix.html
    theme: cerulean
nocite: |
  @Cortez2009aa
csl: apa.csl
bibliography: project.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stats)
library(BSDA)

p.value.string = function(p.value, symbol = "="){
  p.value <- round(p.value, digits = 3)
  if (p.value == 0) {
    return("p < .001")
  } else {
    return(paste0("p", symbol, round(p.value, digits = 3)))
  }
}

#### Import raw data from source
wine_red <- read.csv("winequality-red.csv", sep=";")
wine_white <- read.csv("winequality-white.csv", sep=";")

type <- c(rep("Red Wine", nrow(wine_red)), rep("White Wine", nrow(wine_white))) # create new column to show wine category

wine <- rbind(wine_red, wine_white) # concatenate red and white datasets
wine <- cbind(type, wine) # add category column
```

## Introduction

This project will be comparing different physiochemical and sensory elements of wine. The wine in this data set are Vinho Verde wines, which comes from Minho region of Portugal. The data was collected between May 2004 and February 2007 and includes 1599 red wine samples and 4898 white wine samples. Wine testing is important to both sellers and consumers. By testing wine samples, vineyards are able to ensure that their wines are safe for consumers and that the taste of each type of wine stays consistent. It is even used to help set pricing scales. 

This study looked at 11 different physicochemical variables: fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulphates, and alcohol content. This data also contains a sensory score variable called “quality.” Each wine sample was tasted by at least 3 judges, each of whom scored the wine from 0 (very bad) to 10 (excellent). The quality variable was the median of the scores. 

## Hypotheses

Clearly state the hypotheses being tested.  (20 points)

- Are mean quality of red wines equal to mean quality of white wines?
- Are variances of quality of red wines equal to variances of quality of white wines?
- Do phoisochemical attributes significantlty affect quality?
- If so which physiochemical attributes significantlty affect quality?
- Is there an interaction between citric acid and pH for red wines as it affects quality?

## Methods

State and explain the methodology used to test the hypotheses.  (20 points)

<!--
Note from Adrienne
I did some tweaking for the methods section  I've been working with my principal on writing his PhD prospectus and thesis.  The methods chapter doesn't have any results in it.  It just has what tests he plans to run.  (For his thesis, he plans on using an independent samples t-test, using pre-existing data).  I really think this is what we should have here.  I think stating that we are testing assumptions is good methodology, but I think we should list out what methods we use to test each hypothesis.  
-->

Below, you will find the tests for each hypothesis and a brief explanation and justification for each test.


**-Are mean quality of red wines equal to mean quality of white wines?**  

Provided the data meets the assumptions, we will use ANOVA because the two sets of data are independent and this test will allow us to compare means.

**-Are variances of quality of red wines equal to variances of quality of white wines?**

We plan on using $F$ test because this test will allow us to compare the variances of each data set to see if they are equal.

**-Do phoisochemical attributes significantlty affect quality?**

We will use multivariable regression because this will allow us to create a model that will show if there is any relationship between any of the attributes and the quality of the wine.  We will start with pairwise scatterplots which will give us a visual idea of what the data looks like.  We will also run a lack of fit test to make sure our regression model fits. We will run Pearson's/Spearman's Correlation Coefficient (whichever is appropriate)

**-If so, which physiochemical attributes significantlty affect quality?**

We will run t-tests on each predictor to determine which, if any, significantly affect quality.

**-Is there an interaction between citric acid and pH for red wines as it affects quality?**

We will set up a regression model and test to see if there is an interaction. 


All tests are run at the $95\%$ confidence level unless otherwise noted

<!--
I feel like this is a better break down of the methods section, but am open to suggestions/comments.  Please let me know what you think.
-->


To compare the mean quality of red and white wines, we first note we are working with independent data points--that is the data for red wine is not affected by the data for white wine. Then, we visually examine data and the residuals through plots to test for normality and similar variance. We see that our variances are similar (from the length of vertical lines in the "Residuals vs Fitted" plot). We see the residuals are normally distributed because the histogram is mound-shaped and centered around zero and the q-q plot shows few deviations from a 45° line. The data meet the assumptions for an ANOVA test, so we perform the ANOVA test.

``` {r}
wine_anova <- aov(quality ~ type, data = wine)
wine_anova_table <- summary(wine_anova)
wine_anova_table

plot_anova_assumptions <- function(aov.results){
  par(mfrow=c(2,2))
  plot(aov.results, which=1)
  plot(aov.results, which=2)
  aov_residuals <- residuals(aov.results)
  plot(density(aov_residuals))
  hist(aov_residuals)
}

plot_anova_assumptions(wine_anova)
```

To test the variability of the quality scores of red and white wines, we use an $F$ test at the 95% confidence level.

``` {r}
wine_quality_var.f <- var.test(wine_red$quality, wine_white$quality, alternative = "t", conf.level = 0.95, ratio = 1)
```

## Results

Describe the data (1st paragraph) as well as analysis results (order of results should correspond to hypotheses listed).  (20 points)

The mean quality scores of red and white wines is significantly different ($`r p.value.string(wine_anova_table[[1]][["Pr(>F)"]][1])`$) at the $\alpha = .05$ level.

The variability of the quality scores of red and white wines is significantly different ($`r p.value.string(wine_quality_var.f$p.value)`$, $`r (wine_quality_var.f$p.value)`$) at the $\alpha = .05$ level.

## Conclusion

Restate the results in terms of the larger picture; state limitations and opportunities for future research (20 points)

## Reference

<!-- Work

### Chad and Tyler's initial work

#### Testing data summarization

```{r}
white.summary <- wine_white %>% summarise(mean.citric.acid = mean(citric.acid), sd.citric.acid = sd(citric.acid), median.citric.acid = median(citric.acid))
white.summary
```

The mean (standard deviation) citric acid content is `r round(white.summary$mean.citric.acid[1], digits = 2)` (`r round(white.summary$sd.citric.acid[1], digits = 2)`) <br>
The median citric acid content is `r round(white.summary$median.citric.acid[1], digits = 2)`.

#### Test of variability pH

##### Hypotheses

* $H_0: \sigma_r = \sigma_w$
* $H_1: \sigma_r \ne \sigma_w$

##### Test statistic

```{r, warning=FALSE}
pHvar.f <- var.test(wine_red$pH, wine_white$pH, alternative = "t", conf.level = 0.95, ratio = 1)
```

* $F_0 = `r round(pHvar.f$statistic, digits = 2)`$.
* $`r p.value.string(pHvar.f$p.value)`$.

##### Rejection region

Reject $H_0$ if $p < \alpha$, where $\alpha=0.05$. $`r p.value.string(pHvar.f$p.value)` \nless 0.05.$

##### Conclusion and interpretation

Fail to reject $H_0$. There is insufficient evidence to suggest that there is a difference in the variability of pH between red and white wines.

### Jovan's initial work

```{r}
# wine_red <- read.csv("winequality-red.csv", sep=";")
# wine_white <- read.csv("winequality-white.csv", sep=";")
# wine <- rbind(wine_red, wine_white)
# type <- as.factor(c(rep("Red Wine", nrow(wine_red)), rep("White Wine", nrow(wine_white))))
# wine <- cbind(wine, type)
```

#### 1. One Way Anova Test on the contain of Sulfure Dioxide

```{r}
wine.Summary <-  wine %>% group_by(type) %>% summarise(mean_alcohol = mean(total.sulfur.dioxide), stdev_alcohol = sd(total.sulfur.dioxide))
wine.Summary
```

```{r}
wine_anova_results <- aov(total.sulfur.dioxide ~ type, data = wine)
wine_anova_table <- summary(wine_anova_results)
wine_anova_table
#pander(wine_anova_table, style='rmarkdown') 
```

##### Hypothesis test

**Hypotheses**

$H_0: \ \mu_1 = \mu_2$ <br> 
$H_1: \ \mu_1 \ne \mu_2$

**Test Statistic**

$F_0 = `r p.value.string(wine_anova_table[[1]][["F value"]][1])`$.

***p*-value**

$`r p.value.string(wine_anova_table[[1]][["Pr(>F)"]][1])`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Reject $H_0$. There is sufficient evidence to suggest that the total sulfure dioxide contain in the two wine are diferent.

### Adrienne's initial work

#### Testing assumptions on ANOVA

```{r plotting fancily}
almost_sas <- function(aov.results){
  par(mfrow=c(2,2))
  plot(aov.results, which=1)
  plot(aov.results, which=2)
  aov_residuals <- residuals(aov.results)
  plot(density(aov_residuals))
  hist(aov_residuals)
}


almost_sas(wine_anova_results)
```




```
The residuals are normal, but variances are not equal. 
Since there are only two groups, should we look at doing an independent samples t-test with unequal variances?  Or is it better to run ANOVA/KW since we have so many samples?  I'm just curious why ANOVA was run instead of t-test
```

```{r}
y <- as.data.frame(wine_red)
p1 <- ggplot(y, aes(sample = total.sulfur.dioxide))
p1 <- p1 + 
        stat_qq() + 
        stat_qq_line() +
  labs(title="qq plot of sulfur dioxide in red wine")+
        theme_bw()

p1

y <- as.data.frame(wine_white)
p2 <- ggplot(y, aes(sample = total.sulfur.dioxide))
p2 <- p2 + 
        stat_qq() + 
        stat_qq_line() +
  labs(title="qq plot of sulfur dioxinde in white wine")+
        theme_bw()

p2
```

```
Both sets of data are not normal. Is this why we ran ANOVA?   
```
### Jovan's work

#### 2. Kruskal-Wallis Test on the Alcohol Content


```{r}
wine.Summary2 <-  wine %>% group_by(type) %>% summarise(alcohol_median = median(alcohol), alcohol_IQR = IQR(alcohol))
wine.Summary2
```

```{r}
wine_KW_results <- kruskal.test(alcohol ~ type, data = wine)
wine_KW_results
```

**Hypotheses**

$H_0: \ \mbox{M}_1 = \mbox{M}_2$ <br> 
$H_1: \ \mbox{M}_1 \ne \mbox{M}_2$ 

**Test Statistic**

$H = `r round(wine_KW_results$statistic,digits=2)`$.

***p*-value**

$`r p.value.string(wine_KW_results$p.value)`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Fail to reject $H_0$. There is not sufficient evidence to suggest that there is a diferent in the alcohol contain of the two type of wines.

### Adrienne's work

#### Assumptions for KW

```{r}
alcohol_anova_results <- aov(alcohol ~ type, data = wine)
alcohol_anova_results

plot(alcohol_anova_results)

```
```{r}
almost_sas(alcohol_anova_results)
```

looking at theses graphs, we can see that while a lot of our residuals are on the 45 degree line, we have a lot that aren't.  The histogram of our residuals isn't quite bell shaped. It is skewed.  Therefore, we say that normality is broken and Kruskal-Walis was necessary.

```
Since we have only two groups, should we run an indpendent samples t-test? Or the nonparametric version?  Or is it better to run the anova and KW since we have so many samples?
```
### Jovan's work

#### 3. Test of variability pH


```{r}
pHvar <- var.test(wine_red$pH, wine_white$pH, alternative = "t", conf.level = 0.95, ratio = 1)
pHvar 
```

**Hypotheses**

* $H_0: \sigma_r = \sigma_w$
* $H_1: \sigma_r \ne \sigma_w$

**Test Statistic**

* $F_0 = `r round(pHvar$statistic, digits = 2)`$.
* $`r p.value.string(pHvar$p.value)`$.

**Rejection Region**

Reject $H_0$ if $p < \alpha$, where $\alpha=0.05$. $`r p.value.string(pHvar$p.value)` \nless 0.05.$

**Conclusion and Interpretation**

Fail to reject $H_0$. There is insufficient evidence to suggest that there is a difference in the variability of pH between red and white wines.


#### 4. Test of contain of Chlorides

Formally test to determine if the mean of the chlorides contain on red wine is greater than that of white wine. Use the appropriate version of the t-test with the critical at the α = 0.05 level.

```{r}
wine.Summary <-  wine %>% group_by(type) %>% summarise(mean_alcohol = mean(chlorides), stdev_alcohol = sd(chlorides))
wine.Summary
```

```{r}
chlorides_t <- t.test(wine_red$chlorides, wine_white$chlorides, paired = FALSE, alternative = "greater")
chlorides_t
chlorides_p <- p.value.string(chlorides_t$p.value)
```

**Hypotheses**

$H_0: \ \mu_R \le \mu_W$ <br> 
$H_1: \ \mu_R > \mu_w$

**Test Statistic**

$t_0 = `r round(chlorides_t$statistic, digits=3)`$.

***p*-value**

$`r chlorides_p`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.01$.

**Conclusion and Interpretation**

Reject $H_0$. There is sufficient evidence to suggest that the contain chlorides in the red wine are greather than the white wine.


#### 5. Test of variability of residual sugar 

```{r}
rsvar <- var.test(wine_red$residual.sugar, wine_white$residual.sugar, alternative = "t", conf.level = 0.95, ratio = 1)
rsvar
```

**Hypotheses**

* $H_0: \sigma_r = \sigma_w$
* $H_1: \sigma_r \ne \sigma_w$

**Test Statistic**

* $F_0 = `r round(rsvar$statistic, digits = 2)`$.
* $`r p.value.string(rsvar$p.value)`$.

**Rejection Region**

Reject $H_0$ if $p < \alpha$, where $\alpha=0.05$. $`r p.value.string(rsvar$p.value)` < 0.05.$

**Conclusion and Interpretation**

Reject $H_0$. There is sufficient evidence to suggest that there is a difference in the variability of residual sugar contain between red and white wines.


#### 6. Test of contain of Citrid Acid

Formally test to determine if the mean of the citrid acid contain on red wine is less than that of white wine. Use the appropriate version of the t-test with the critical at the α = 0.05 level.

```{r}
wine.Summary3 <-  wine %>% group_by(type) %>% summarise(mean_alcohol = mean(citric.acid), stdev_alcohol = sd(citric.acid))
wine.Summary3
```

```{r}
citricacid_t <- t.test(wine_red$citric.acid, wine_white$citric.acid, paired = FALSE, alternative = "less")
citricacid_t
citricacid_p <- p.value.string(chlorides_t$p.value)
```

**Hypotheses**

$H_0: \ \mu_R \ge \mu_W$ <br> 
$H_1: \ \mu_R < \mu_w$

**Test Statistic**

$t_0 = `r round(citricacid_t$statistic, digits=3)`$.

***p*-value**

$`r citricacid_p`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.01$.

**Conclusion and Interpretation**

Reject $H_0$. There is sufficient evidence to suggest that the contain of citric acid in the red wine is less than the white wine.


#### 7. Proportion Test on Density??? 

```
What are density units for wine?  What does this mean in the real world? What does density greater than one mean?  Why did we run this test three times with numbers so close to each other?  (not critisising... just trying to figure out what's going on)---this would be a good intro to this section
```

```{r}
wine_density1 <- z.test(wine$density, alternative = "greater", mu = 1, sigma.x = sd(wine$density))
wine_density1
```

**Hypotheses**

$H_0: \ \mu \le 1$ <br>
$H_1: \ \mu > 1$

**Test Statistic**

$z = `r wine_density1$statistic`$.

***p*-value**

$p = `r wine_density1$p.value`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Fail to reject $H_0$. There is not sufficient evidence to suggest that the mean density wine is greater than 1.

```{r}
wine_density2 <- z.test(wine$density, alternative = "less", mu = 0.98, sigma.x = sd(wine$density))
wine_density2
```

**Hypotheses**

$H_0: \ \mu \ge 0.98$ <br>
$H_1: \ \mu < 0.98$

```
Changed the alternative hypothesis to match test run
```

**Test Statistic**

$z = `r wine_density2$statistic`$.

***p*-value**

$p = `r wine_density2$p.value`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Fail to reject $H_0$. There is not sufficient evidence to suggest that the mean density wine is less than 0.98.

```{r}
wine_density3 <- z.test(wine$density, alternative = "less", mu = 0.99, sigma.x = sd(wine$density))
wine_density3
```

**Hypotheses**

$H_0: \ \mu \ge 0.99$ <br>
$H_1: \ \mu < 0.99$

```
Changed alternate hypothesis to match test run
```

**Test Statistic**

$z = `r wine_density3$statistic`$.

***p*-value**

$p = `r wine_density3$p.value`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Fail to reject $H_0$. There is not sufficient evidence to suggest that the mean density wine is less than 0.99.


#### 8. Regression model

```
What is the regression actually modeling? for every one unit increase in all these predictors, what is our outcome?
Why don't we break it down and run just a few of these and have something that might be related?  like see if sulfur dioxide predicts pH or if alcohol content predicts sulfur 
```

Then in the idividual predictors, we need to test what we decide on one by one as predictors of our outcome.  

```{r}
one_model <- lm(quality ~ fixed.acidity + volatile.acidity + citric.acid + residual.sugar + chlorides + total.sulfur.dioxide + density + pH + sulphates + alcohol, data=wine)
one_coef <- coefficients(one_model)
one_anova <- anova(one_model)
one_summary <- summary(one_model)
one_t <- as_tibble(one_summary[[4]])
one_ci <- as_tibble(confint(one_model, level=0.95))
```

The resulting regression model is 
\[ \hat{y} = `r one_coef[[1]]` + `r one_coef[[2]]`x_1 + `r one_coef[[3]]`x_2 + `r one_coef[[4]]`x_3 + `r one_coef[[5]]`x_4 + `r one_coef[[6]]`x_5 + `r one_coef[[7]]`x_6 + `r one_coef[[8]]`x_7 + `r one_coef[[9]]`x_8 + `r one_coef[[10]]`x_9\]

#### ANOVA table and testing for significance of regression line

The corresponding ANOVA table is as follows

```{r}
one_anova
```

**Hypotheses**

$H_0: \ \beta_1=\beta_2=\beta_3=\beta_4=\beta_5=\beta_6=\beta_7=\beta_8=\beta_9 = 0$ <br>
$H_1: $ at least one is not zero

```
changed hypothesis to match test run.  The test is an F test... a multivariable model with nine betas. 
```


**Test Statistic**

$F_0 = `r round(one_anova$"F value"[1], digits=2)`$.

***p*-value**

$`r p.value.string(one_anova$"Pr(>F)"[3])`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Comparing every p value of the previous table with the alpha, can be check that with at lest one of then is greather than alpha, by this reason fail to reject $H_0$. There is not sufficient evidence to suggest that the regression line is significant.

#### Testing for significance of individual predictor

##### Test for fixed acidity

**Hypotheses**

$H_0: \ \beta_1 = 0$ <br>
$H_1: \ \beta_1 \ne 0$

**Test Statistic**

$t_0 = `r round(one_t$"t value"[2], digits=2)`$.

***p*-value**

$`r p.value.string(one_t$"Pr(>|t|)"[4])`$.

**Rejection Region**

Reject if $p < \alpha$, where $\alpha=0.05$.

**Conclusion and Interpretation**

Comparing every p value of the previous table with the alpha, can be check that with at lest one of then is greather than alpha, by this reason fail to reject $H_0$. There is not sufficient evidence to suggest that fixed acidity is a significant predictor of 

-->
